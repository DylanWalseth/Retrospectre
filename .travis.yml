language: node_js
sudo: required
notifications:
  slack: retrospectre:DT9bWKb0zenFvq6umddlg0ko
node_js:
    - '0.12'
env:
    - JASMINE_SERVER_UNIT=0 JASMINE_SERVER_INTEGRATION=1 JASMINE_CLIENT_UNIT=1 JASMINE_CLIENT_INTEGRATION=1 JASMINE_BROWSER=PhantomJS
branches:
  except:
    - release-dev
    - release-prd
before_install:
    - "curl https://install.meteor.com/ | sh"
    - npm install -g gulp
    - npm install -g velocity-cli
before_script:
    - gulp lint
    - pkill -9 phantomjs || true
    - pkill -9 node || true
script:
    - ( cd src && velocity test-app --ci )
after_success:
    - bash release.sh
